{{- /*
  Default Single Page Layout - 默认单页布局模板
  
  支持两种模式：
  1. sections 模式：通过 Front Matter 的 sections 配置组装页面
  2. 文章模式：传统的博客文章布局（默认）
  
  Front Matter 配置示例（sections 模式）：
  ---
  sections:
    - type: "hero"
      title: "..."
    - type: "features"
      items: [...]
  ---
  
  Requirements: 3.1
*/ -}}

{{- define "main" -}}

{{- /* 检查是否有 sections 配置 */ -}}
{{- if .Params.sections -}}
  {{- /* Sections 模式：遍历 sections 配置，渲染对应的 Widget */ -}}
  {{- range .Params.sections -}}
    {{- $widgetType := .type | default "" -}}
    
    {{- if $widgetType -}}
      {{- /* 构建 widget partial 路径 */ -}}
      {{- $partialPath := printf "widgets/%s.html" $widgetType -}}
      
      {{- /* 检查 partial 是否存在 */ -}}
      {{- if templates.Exists (printf "partials/%s" $partialPath) -}}
        {{- partial $partialPath . -}}
      {{- else -}}
        <!-- Widget "{{ $widgetType }}" not found at partials/{{ $partialPath }} -->
      {{- end -}}
    {{- end -}}
  {{- end -}}
  
  {{- /* 如果有 .Content，也渲染出来 */ -}}
  {{- if .Content -}}
  <section class="py-12 md:py-16 lg:py-20">
    <div class="max-w-7xl mx-auto px-4 md:px-6">
      <div class="prose prose-lg dark:prose-invert max-w-none">
        {{ .Content }}
      </div>
    </div>
  </section>
  {{- end -}}

{{- else -}}
  {{- /* 文章模式：传统的博客文章布局 */ -}}
<section class="py-8 sm:py-16 lg:py-20 mx-auto">
  <article>
    {{- /* 文章头部 */ -}}
    <header class="mb-8">
      {{- /* 元信息：日期、作者、分类、阅读时间 */ -}}
      <div class="flex flex-wrap items-center gap-2 max-w-3xl mx-auto mt-0 mb-4 px-4 sm:px-6 text-sm text-muted dark:text-slate-400">
        {{- /* 日期 */ -}}
        <span class="inline-flex items-center">
          <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <time datetime="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
            {{ .Date.Format "2006-01-02" }}
          </time>
        </span>
        
        {{- /* 作者 */ -}}
        {{- with .Params.author }}
        <span class="inline-flex items-center">
          <span class="mx-1">·</span>
          <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
          </svg>
          {{ . }}
        </span>
        {{- end }}
        
        {{- /* 分类 */ -}}
        {{- with .Params.categories }}
        {{- range first 1 . }}
        <span class="inline-flex items-center">
          <span class="mx-1">·</span>
          <a class="hover:text-primary dark:hover:text-blue-400 transition" href="{{ printf "/categories/%s/" (. | urlize) | relLangURL }}">
            {{ . }}
          </a>
        </span>
        {{- end }}
        {{- end }}
        
        {{- /* 阅读时间 */ -}}
        {{- if gt .ReadingTime 0 }}
        <span class="inline-flex items-center">
          <span class="mx-1">·</span>
          {{ i18n "reading_time" .ReadingTime | default (printf "%d min read" .ReadingTime) }}
        </span>
        {{- end }}
        
        {{- /* 字数 */ -}}
        {{- if gt .WordCount 0 }}
        <span class="inline-flex items-center">
          <span class="mx-1">·</span>
          {{ i18n "word_count" .WordCount | default (printf "%d words" .WordCount) }}
        </span>
        {{- end }}
      </div>
      
      {{- /* 标题 */ -}}
      <h1 class="px-4 sm:px-6 max-w-3xl mx-auto text-4xl md:text-5xl font-bold leading-tighter tracking-tighter font-heading dark:text-slate-200">
        {{ .Title }}
      </h1>
      
      {{- /* 描述/摘要 */ -}}
      {{- with .Description }}
      <p class="max-w-3xl mx-auto mt-4 mb-8 px-4 sm:px-6 text-xl md:text-2xl text-muted dark:text-slate-400">
        {{ . }}
      </p>
      {{- end }}
      
      {{- /* 封面图片 */ -}}
      {{- with .Params.image }}
      <div class="max-w-full lg:max-w-[900px] mx-auto mb-6 overflow-hidden sm:rounded-md">
        <img src="{{ . }}" 
             class="w-full h-auto bg-gray-400 dark:bg-slate-700" 
             alt="{{ $.Title }}" 
             loading="eager" 
             decoding="async">
      </div>
      {{- else }}
      <div class="max-w-3xl mx-auto px-4 sm:px-6">
        <div class="border-t dark:border-slate-700"></div>
      </div>
      {{- end }}
    </header>
    
    {{- /* 主内容区域 - 带侧边栏布局 */ -}}
    <div class="max-w-7xl mx-auto px-4 sm:px-6">
      <div class="flex flex-col lg:flex-row gap-8">
        {{- /* 文章内容 */ -}}
        <div class="flex-1 min-w-0">
          {{- /* 目录 - 移动端显示在内容上方 */ -}}
          {{- if and .TableOfContents (gt (len .TableOfContents) 100) }}
          <div class="lg:hidden mb-8">
            {{ partial "blog/toc.html" . }}
          </div>
          {{- end }}
          
          {{- /* 文章正文 */ -}}
          <div class="prose prose-lg lg:prose-xl dark:prose-invert dark:prose-headings:text-slate-300 prose-headings:font-heading prose-headings:leading-tighter prose-headings:tracking-tighter prose-headings:font-bold prose-a:text-primary dark:prose-a:text-blue-400 prose-img:rounded-md prose-img:shadow-lg prose-headings:scroll-mt-[80px] prose-li:my-0 max-w-none">
            {{ .Content }}
          </div>
          
          {{- /* 标签和分享 */ -}}
          <div class="mt-8 pt-8 border-t dark:border-slate-700 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
            {{- /* 标签 */ -}}
            {{- with .Params.tags }}
            <div class="flex flex-wrap gap-2">
              {{- range . }}
              <a href="{{ printf "/tags/%s/" (. | urlize) | relLangURL }}" 
                 class="inline-block px-3 py-1 text-sm bg-gray-100 dark:bg-slate-700 text-muted dark:text-slate-300 hover:text-primary dark:hover:text-blue-400 rounded-full transition lowercase">
                #{{ . }}
              </a>
              {{- end }}
            </div>
            {{- end }}
            
            {{- /* 社交分享 */ -}}
            {{ partial "blog/social-share.html" . }}
          </div>
          
          {{- /* 上一篇/下一篇导航 */ -}}
          {{ partial "blog/post-nav.html" . }}
        </div>
        
        {{- /* 侧边栏 - 桌面端显示 */ -}}
        {{- if and .TableOfContents (gt (len .TableOfContents) 100) }}
        <aside class="hidden lg:block w-64 shrink-0">
          <div class="sticky top-24">
            {{ partial "blog/toc.html" . }}
          </div>
        </aside>
        {{- end }}
      </div>
    </div>
    
    {{- /* 相关文章 */ -}}
    {{ partial "blog/related-posts.html" . }}
  </article>
</section>
{{- end -}}
{{- end -}}
