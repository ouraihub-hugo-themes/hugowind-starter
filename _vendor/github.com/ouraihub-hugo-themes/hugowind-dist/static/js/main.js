(()=>{var m=Object.defineProperty;var g=(o,e,t)=>e in o?m(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var i=(o,e,t)=>(g(o,typeof e!="symbol"?e+"":e,t),t);var l=class{constructor(){i(this,"currentTheme","system");i(this,"defaultTheme","system");i(this,"isLocked",!1);i(this,"mediaQuery");i(this,"boundSystemThemeHandler");this.mediaQuery=window.matchMedia("(prefers-color-scheme: dark)"),this.boundSystemThemeHandler=this.handleSystemThemeChange.bind(this),this.init()}init(){this.loadDefaultTheme(),this.loadTheme(),this.setupToggle(),this.watchSystemTheme(),this.setupTransition(),this.updateToggleIcons()}loadDefaultTheme(){let e=document.querySelector("[data-theme-config]");if(e){let t=e.getAttribute("data-theme-config")||"system";this.isLocked=t.endsWith(":only"),this.defaultTheme=t.replace(":only","")}}loadTheme(){if(this.isLocked)this.currentTheme=this.defaultTheme;else{let e=localStorage.getItem("theme");e&&["light","dark","system"].includes(e)?this.currentTheme=e:this.defaultTheme!=="system"?this.currentTheme=this.defaultTheme:this.currentTheme="system"}this.applyTheme(!1)}applyTheme(e=!0){let t=this.isDarkMode();e&&this.enableTransition(),document.documentElement.classList.toggle("dark",t),e&&window.HugoWindObserver&&window.HugoWindObserver.removeAnimationDelay(),this.updateToggleIcons()}isDarkMode(){return this.currentTheme==="dark"?!0:this.currentTheme==="light"?!1:this.mediaQuery.matches}setupToggle(){document.addEventListener("click",e=>{e.target.closest("[data-aw-toggle-color-scheme]")&&(e.preventDefault(),this.toggle())})}watchSystemTheme(){this.mediaQuery.addEventListener("change",this.boundSystemThemeHandler)}handleSystemThemeChange(){this.currentTheme==="system"&&this.applyTheme()}setupTransition(){if(!document.getElementById("theme-transition-style")){let e=document.createElement("style");e.id="theme-transition-style",e.textContent=`
        .theme-transition,
        .theme-transition *,
        .theme-transition *::before,
        .theme-transition *::after {
          transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease, fill 0.3s ease, stroke 0.3s ease !important;
        }
      `,document.head.appendChild(e)}}enableTransition(){document.documentElement.classList.add("theme-transition"),setTimeout(()=>{document.documentElement.classList.remove("theme-transition")},300)}updateToggleIcons(){let e=document.documentElement.classList.contains("dark");document.querySelectorAll("[data-aw-toggle-color-scheme]").forEach(t=>{let s=t.querySelector(".icon-sun"),r=t.querySelector(".icon-moon");s&&r&&(s.classList.toggle("hidden",e),r.classList.toggle("hidden",!e))})}toggle(){if(this.isLocked)return;let e=document.documentElement.classList.contains("dark");this.currentTheme=e?"light":"dark",localStorage.setItem("theme",this.currentTheme),this.applyTheme()}setTheme(e){this.isLocked||(this.currentTheme=e,e==="system"?localStorage.removeItem("theme"):localStorage.setItem("theme",e),this.applyTheme())}getTheme(){return this.currentTheme}getEffectiveTheme(){return this.isDarkMode()?"dark":"light"}destroy(){this.mediaQuery.removeEventListener("change",this.boundSystemThemeHandler),document.querySelectorAll("[data-aw-toggle-color-scheme]").forEach(e=>{e.replaceWith(e.cloneNode(!0))})}};var d=class{constructor(){i(this,"header");i(this,"toggleBtn");i(this,"nav");i(this,"lastChild");i(this,"mediaQuery");i(this,"boundResizeHandler");i(this,"boundScrollHandler");i(this,"lastScrollY",0);i(this,"ticking",!1);this.header=document.getElementById("header"),this.toggleBtn=document.querySelector("[data-aw-toggle-menu]"),this.nav=document.querySelector("#header nav"),this.lastChild=document.querySelector("#header > div > div:last-child"),this.mediaQuery=window.matchMedia("(max-width: 767px)"),this.boundResizeHandler=this.handleResize.bind(this),this.boundScrollHandler=this.handleScroll.bind(this),this.init()}init(){this.setupMobileMenu(),this.setupScrollEffect(),this.setupDropdowns(),this.setupResizeHandler(),this.setupTouchInteractions(),this.setupLazyLoading()}setupMobileMenu(){this.toggleBtn&&(this.toggleBtn.addEventListener("click",()=>{this.toggleMenu()}),this.nav?.addEventListener("click",e=>{let t=e.target;t.tagName==="A"&&!t.closest(".dropdown")&&this.closeMenu()}))}toggleMenu(){this.toggleBtn?.classList.contains("expanded")?this.closeMenu():this.openMenu()}openMenu(){this.toggleBtn?.classList.add("expanded"),this.header?.classList.add("h-screen","expanded","bg-page"),this.nav?.classList.remove("hidden"),this.lastChild?.classList.remove("hidden"),document.body.classList.add("overflow-hidden")}closeMenu(){this.toggleBtn?.classList.remove("expanded"),this.header?.classList.remove("h-screen","expanded","bg-page"),this.nav?.classList.add("hidden"),this.lastChild?.classList.add("hidden"),document.body.classList.remove("overflow-hidden")}setupScrollEffect(){this.header?.hasAttribute("data-aw-sticky-header")&&(window.addEventListener("scroll",this.boundScrollHandler,{passive:!0}),this.applyScrollStyles())}handleScroll(){this.lastScrollY=window.scrollY,this.ticking||(window.requestAnimationFrame(()=>{this.applyScrollStyles(),this.ticking=!1}),this.ticking=!0)}applyScrollStyles(){this.header&&(this.lastScrollY>60?this.header.classList.add("scroll"):this.header.classList.remove("scroll"))}setupDropdowns(){document.querySelectorAll(".dropdown").forEach(e=>{let t=e.querySelector("button"),s=e.querySelector("ul");!t||!s||t.addEventListener("click",r=>{window.innerWidth<768&&(r.preventDefault(),r.stopPropagation(),s.classList.toggle("hidden"),document.querySelectorAll(".dropdown ul").forEach(n=>{n!==s&&n.classList.add("hidden")}))})}),document.addEventListener("click",e=>{e.target.closest(".dropdown")||document.querySelectorAll(".dropdown ul").forEach(s=>{window.innerWidth<768&&s.classList.add("hidden")})})}setupResizeHandler(){this.mediaQuery.addEventListener("change",this.boundResizeHandler)}handleResize(){this.mediaQuery.matches||(this.closeMenu(),document.querySelectorAll(".dropdown ul").forEach(e=>{e.classList.remove("hidden")}))}setupTouchInteractions(){("ontouchstart"in window||navigator.maxTouchPoints>0)&&(document.documentElement.classList.add("touch-device"),document.querySelectorAll('a, button, [role="button"]').forEach(t=>{t.addEventListener("touchstart",()=>{t.classList.add("touch-active")},{passive:!0}),t.addEventListener("touchend",()=>{setTimeout(()=>{t.classList.remove("touch-active")},100)},{passive:!0})}))}setupLazyLoading(){let e=document.querySelectorAll("img[data-src]");if("IntersectionObserver"in window){let t=new IntersectionObserver(s=>{s.forEach(r=>{if(r.isIntersecting){let n=r.target,a=n.dataset.src;a&&(n.src=a,n.removeAttribute("data-src"),n.classList.add("loaded")),t.unobserve(n)}})},{rootMargin:"50px 0px",threshold:.01});e.forEach(s=>t.observe(s))}else e.forEach(t=>{let s=t,r=s.dataset.src;r&&(s.src=r,s.removeAttribute("data-src"))})}destroy(){window.removeEventListener("scroll",this.boundScrollHandler),this.mediaQuery.removeEventListener("change",this.boundResizeHandler)}};var c=class{constructor(){i(this,"observer",null);i(this,"animationCounter",0);i(this,"delayBetweenAnimations",100);this.init()}init(){if(typeof IntersectionObserver>"u"){this.showAllElements();return}this.setupIntersectionObserver()}setupIntersectionObserver(){let e=['[class*=" intersect:"]','[class*=":intersect:"]','[class^="intersect:"]','[class="intersect"]','[class*=" intersect "]','[class^="intersect "]','[class$=" intersect"]',".intersect-once"],t=document.querySelectorAll(e.join(","));t.length!==0&&(t.forEach(s=>{s.setAttribute("no-intersect",""),s.dataset.intersectionThreshold=String(this.getThreshold(s))}),this.observer=new IntersectionObserver(s=>{s.forEach(r=>{requestAnimationFrame(()=>{let n=r.target,a=parseFloat(n.dataset.intersectionThreshold||"0");if(n.classList.contains("intersect-no-queue"))r.isIntersecting&&r.intersectionRatio>=a&&this.triggerAnimation(n);else if(r.isIntersecting&&r.intersectionRatio>=a){let u=this.animationCounter*this.delayBetweenAnimations;this.animationCounter++,setTimeout(()=>{this.triggerAnimation(n)},u)}})})},{root:null,rootMargin:"0px",threshold:[0,.25,.5,.99]}),t.forEach(s=>{this.observer?.observe(s)}))}getThreshold(e){return e.classList.contains("intersect-full")?.99:e.classList.contains("intersect-half")?.5:e.classList.contains("intersect-quarter")?.25:0}triggerAnimation(e){e.removeAttribute("no-intersect"),e.classList.add("intersected"),e.classList.contains("intersect-once")&&this.observer?.unobserve(e)}showAllElements(){document.querySelectorAll("[no-intersect]").forEach(t=>{t.removeAttribute("no-intersect"),t.classList.add("intersected")})}destroy(){this.observer&&(this.observer.disconnect(),this.observer=null)}};var h=class{constructor(){i(this,"modal",null);i(this,"input",null);i(this,"results",null);i(this,"stats",null);i(this,"loading",null);i(this,"isOpen",!1);this.init()}init(){this.modal=document.getElementById("search-modal"),this.input=document.getElementById("search-input"),this.results=document.getElementById("search-results"),this.stats=document.getElementById("search-stats"),this.loading=document.getElementById("search-loading"),this.modal&&(this.setupEventListeners(),this.loadPagefind())}setupEventListeners(){document.querySelectorAll("[data-search-trigger]").forEach(t=>{t.addEventListener("click",s=>{s.preventDefault(),this.open()})}),document.querySelectorAll("[data-search-close]").forEach(t=>{t.addEventListener("click",()=>this.close())}),this.modal?.querySelector(".search-overlay")?.addEventListener("click",()=>this.close()),document.addEventListener("keydown",t=>{t.key==="Escape"&&this.isOpen&&this.close(),(t.ctrlKey||t.metaKey)&&t.key==="k"&&(t.preventDefault(),this.toggle())}),this.input?.addEventListener("input",()=>{this.performSearch(this.input?.value||"")})}async loadPagefind(){try{let e=document.createElement("script");e.src="/_pagefind/pagefind.js",e.async=!0,e.onload=()=>{console.log("\u2728 Pagefind loaded")},e.onerror=()=>{console.warn("Pagefind not available - search disabled")},document.head.appendChild(e)}catch(e){console.error("Failed to load Pagefind:",e)}}open(){this.modal&&(this.isOpen=!0,this.modal.classList.add("show"),document.body.style.overflow="hidden",setTimeout(()=>{this.input?.focus()},100))}close(){this.modal&&(this.isOpen=!1,this.modal.classList.remove("show"),document.body.style.overflow="",this.input&&(this.input.value=""),this.results&&(this.results.innerHTML=""),this.stats&&(this.stats.innerHTML=""))}toggle(){this.isOpen?this.close():this.open()}async performSearch(e){if(!e.trim()){this.clearResults();return}if(!window.pagefind){this.showError("\u641C\u7D22\u529F\u80FD\u672A\u52A0\u8F7D");return}this.showLoading(!0);try{let t=await window.pagefind.debouncedSearch(e,{debounce:300});if(this.showLoading(!1),!t||t.results.length===0){this.showNoResults(e);return}await this.renderResults(t.results,e)}catch(t){console.error("Search error:",t),this.showLoading(!1),this.showError("\u641C\u7D22\u51FA\u9519\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5")}}async renderResults(e,t){if(!this.results||!this.stats)return;let s=[];for(let r of e.slice(0,10))try{let n=await r.data(),a=this.highlightKeyword(n.meta.title||"\u65E0\u6807\u9898",t),u=this.highlightKeyword(n.excerpt||"",t);s.push(`
          <li class="search-result-item">
            <a href="${n.url}" class="block p-4 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
              <h3 class="text-lg font-semibold text-heading mb-2">${a}</h3>
              <p class="text-sm text-muted line-clamp-2">${u}</p>
            </a>
          </li>
        `)}catch(n){console.error("Error processing result:",n)}this.results.innerHTML=`<ul class="space-y-2">${s.join("")}</ul>`,this.stats.innerHTML=`<p class="text-sm text-muted">\u627E\u5230 ${e.length} \u6761\u7ED3\u679C</p>`}highlightKeyword(e,t){if(!t)return e;let s=new RegExp(`(${this.escapeRegex(t)})`,"gi");return e.replace(s,'<mark class="bg-yellow-200 dark:bg-yellow-800 px-0.5 rounded">$1</mark>')}escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}showLoading(e){this.loading&&this.loading.classList.toggle("hidden",!e)}clearResults(){this.results&&(this.results.innerHTML=""),this.stats&&(this.stats.innerHTML="")}showNoResults(e){this.results&&(this.results.innerHTML=`
        <div class="text-center py-8">
          <p class="text-muted">\u672A\u627E\u5230 "${e}" \u7684\u76F8\u5173\u7ED3\u679C</p>
        </div>
      `),this.stats&&(this.stats.innerHTML="")}showError(e){this.results&&(this.results.innerHTML=`
        <div class="text-center py-8">
          <p class="text-red-500">${e}</p>
        </div>
      `)}destroy(){this.close()}};document.addEventListener("DOMContentLoaded",()=>{new l,new d,new c,new h});})();
